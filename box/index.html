<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Pokémon Box</title>
<link rel="icon" type="image/png" href="../pp.png">
<style>
@font-face{font-family:'NeoDunggeunmo';src:url('../NeoDunggeunmoPro-Regular.ttf') format('truetype');font-weight:400;font-style:normal;font-display:swap}
@font-face{font-family:'Galmuri11';src:url('./Galmuri11.ttf') format('truetype');font-weight:400;font-style:normal;font-display:swap}
@font-face{font-family:'Galmuri11-Bold';src:url('./Galmuri11-Bold.ttf') format('truetype');font-weight:700;font-style:normal;font-display:swap}
@font-face{font-family:'Galmuri11-Condensed';src:url('./Galmuri11-Condensed.ttf') format('truetype');font-weight:400;font-style:normal;font-display:swap}

/* ===== Theme ===== */
:root{
  --font-body:'NeoDunggeunmo', ui-monospace, "Courier New", monospace;
  --font-ui:'Galmuri11', var(--font-body);
  --font-ui-bold:'Galmuri11-Bold', var(--font-ui);
  --font-cond:'Galmuri11-Condensed', var(--font-ui);
  --w:1000px; --gap:12px;

  --bg:#000000; --txt:#e9ecef; --mut:#9aa0a6;
  --panel:#0a0b0d; --panel-2:#0f1013; --line:#2a2d33;
  --red:#ff2f3e; --red-border:#3a0a0f; --scan-alpha:.08;
}
*{box-sizing:border-box} html,body{height:100%}
body{
  margin:0;font-family:var(--font-body);color:var(--txt);background:var(--bg);
  -webkit-font-smoothing:none;text-rendering:optimizeSpeed;line-height:1.4
}
.wrap{position:relative;z-index:1;max-width:var(--w);margin:0 auto;padding:16px;display:grid;grid-template-rows:auto 1fr;gap:var(--gap)}

header{position:sticky;top:0;z-index:5;background:linear-gradient(#21080b,#160508);border:1px solid var(--red-border);padding:10px 12px;box-shadow:inset 0 0 0 2px #000}
header .title{display:flex;align-items:center;gap:12px;letter-spacing:1px}
header h1{margin:0;font-size:18px;color:#fff;text-transform:none;font-family:var(--font-ui-bold)}
.ball{width:18px;height:18px;position:relative;display:inline-block;border-radius:50%;
  background:linear-gradient(#e33 0 50%,#fff 0 100%);border:2px solid #000;box-shadow:0 0 0 1px #333 inset}
.ball::before{content:"";position:absolute;left:-2px;right:-2px;top:50%;height:2px;background:#000;transform:translateY(-50%)}
.ball::after{content:"";position:absolute;left:50%;top:50%;width:6px;height:6px;background:#bbb;border:2px solid #000;border-radius:50%;
  transform:translate(-50%,-50%)}
.ball.mini{width:12px;height:12px}.ball.mini::after{width:4px;height:4px}

.layout{display:grid;grid-template-columns:1fr;column-gap:var(--gap);row-gap:0}
@media(min-width:860px){.layout{grid-template-columns:1fr 460px}}

.dex{background:var(--panel);border:1px solid var(--line);padding:var(--gap);position:relative;overflow:hidden}
.group{color:var(--mut);font-size:12px;margin:4px 0 8px;display:flex;align-items:center;gap:8px;font-family:var(--font-ui)}
.group::before,.group::after{content:'';height:1px;background:var(--line);flex:1}
.group-wish{margin:22px 0 14px} #grid-wish{margin-bottom:24px}
.grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:var(--gap)}
@media(min-width:600px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
@media(min-width:980px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}

.mon-card{
  position:relative;background:linear-gradient(180deg,var(--panel-2),#0a0b0d);
  border:1px solid var(--line);padding:10px;display:grid;grid-template-rows:120px auto;gap:8px;
  cursor:pointer;transition:transform .08s,border-color .08s;box-shadow:inset 0 0 0 2px #000
}
.mon-card::after{content:"";position:absolute;right:6px;top:6px;width:18px;height:18px;border-right:2px solid var(--red);border-top:2px solid var(--red);
  filter:drop-shadow(0 0 6px rgba(255,47,62,.35))}
.mon-card:hover{transform:translateY(-1px);border-color:#3d424a}
.mon-card[aria-selected="true"]{outline:1px solid var(--red);outline-offset:-1px;box-shadow:0 0 18px rgba(255,47,62,.35)}
.mon-card.wish{border-style:dashed;border-color:#3a3f46}

.sprite{background:#07080a;border:1px solid var(--line);display:grid;place-items:center;position:relative;overflow:hidden}
.sprite img{max-width:100%;max-height:100%;object-fit:contain}
.sprite::after{content:"";position:absolute;inset:0;background:repeating-linear-gradient(0deg,rgba(255,255,255,var(--scan-alpha)) 0 1px,transparent 1px 3px);mix-blend-mode:overlay;pointer-events:none}
.meta{display:grid;grid-template-columns:auto 1fr;gap:6px 8px;align-items:center}
.no{font-size:11px;color:#9aa0a6}
.name{font-size:13px;color:#e9ecef;letter-spacing:.3px;font-family:var(--font-ui)}
.types{grid-column:1/-1;display:flex;gap:4px;flex-wrap:wrap}

/* type chips */
.type{font-size:9px;padding:0 4px;line-height:1.1;border:1px solid var(--line);background:#0b0d10;color:#eaeaea;letter-spacing:.2px;font-family:var(--font-ui)}
.type.t-normal{background:#A8A77A;color:#111;border-color:#8a8b5f}
.type.t-fire{background:#EE8130;color:#111;border-color:#c86627}
.type.t-water{background:#6390F0;color:#111;border-color:#4f73c3}
.type.t-electric{background:#F7D02C;color:#111;border-color:#d1b122}
.type.t-grass{background:#7AC74C;color:#111;border-color:#5da23b}
.type.t-ice{background:#96D9D6;color:#111;border-color:#78b9b6}
.type.t-fighting{background:#C22E28;color:#fff;border-color:#9b2420}
.type.t-poison{background:#A33EA1;color:#fff;border-color:#822f81}
.type.t-ground{background:#E2BF65;color:#111;border-color:#bf9f53}
.type.t-flying{background:#A98FF3;color:#111;border-color:#8a71d0}
.type.t-psychic{background:#F95587;color:#111;border-color:#cc466f}
.type.t-bug{background:#A6B91A;color:#111;border-color:#889611}
.type.t-rock{background:#B6A136;color:#111;border-color:#94822b}
.type.t-ghost{background:#735797;color:#fff;border-color:#5c467a}
.type.t-dragon{background:#6F35FC;color:#fff;border-color:#582acb}
.type.t-dark{background:#705746;color:#fff;border-color:#5a4638}
.type.t-steel{background:#B7B7CE;color:#111;border-color:#9696ad}
.type.t-fairy{background:#D685AD;color:#111;border-color:#b46c8f}
.type.t-unknown{background:#555;color:#eee;border-color:#444}

/* Details */
.details{
  background:var(--panel);border:1px solid var(--line);
  display:grid;grid-template-rows:auto auto 1fr auto;gap:6px;
  padding:var(--gap);position:sticky;top:60px;height:max-content;overflow:hidden
}
@media(max-width:859.98px){.details{position:static}}

.tabs{display:flex;gap:8px}
.tab-btn{appearance:none;border:1px solid var(--red-border);background:linear-gradient(#1a070a,#120408);color:#fff;
  font-family:var(--font-ui);font-size:12px;letter-spacing:.6px;padding:6px 10px;cursor:pointer;display:flex;align-items:center;gap:6px;box-shadow:inset 0 0 0 2px #000}
.tab-btn[aria-selected="true"]{background:#24060a;outline:1px solid var(--red);outline-offset:-1px;box-shadow:0 0 18px rgba(255,47,62,.35)}
.tab-btn:disabled{opacity:.45;pointer-events:none}

.screen{border:1px solid var(--line);background:#07090c;padding:12px 14px;min-height:300px;display:grid;gap:10px;grid-template-rows:auto 1fr;position:relative;overflow:hidden}
.screen::after{content:"";position:absolute;inset:-40% -10%;background:linear-gradient(90deg,transparent,rgba(220,220,220,.08),transparent);transform:translateX(-100%) rotate(8deg);animation:sweep 6s linear infinite;pointer-events:none}
@keyframes sweep{to{transform:translateX(100%) rotate(8deg)}}

.big{display:grid;grid-template-columns:120px 1fr;gap:12px;align-items:start}
@media(max-width:420px){.big{grid-template-columns:1fr}}
.big .sprite{height:120px}
.big h2{margin:0;font-size:18px;font-family:var(--font-ui)}
.big .id{font-size:12px;color:#9aa0a6;margin-bottom:8px}
.hr{height:1px;background:var(--line);margin:6px 0}
.kv{display:grid;grid-template-columns:58px 1fr;column-gap:4px;row-gap:4px;align-items:start}
.kv .k{color:#9aa0a6;font-size:13px;text-align:left;padding-left:6px;font-family:var(--font-ui)}
.kv .v{color:#e9ecef;font-size:13px;word-break:keep-all;overflow-wrap:break-word}

.extra-box{position:relative;border:1px solid var(--line);background:#090a0d;min-height:140px;overflow:auto;}
.extra-box .placeholder{color:#cfd3d7;font-size:13px;padding:10px}

/* HUD-X */
.hudx-wrap{margin-top:6px}
.hudx-panel{--hudx-h:130px;position:relative;height:var(--hudx-h);
  border:1px solid rgba(255,47,62,.35);background:linear-gradient(180deg,#090a0c,#050607);
  box-shadow:inset 0 0 0 1px #000,0 0 24px rgba(255,47,62,.08);overflow:hidden}
#hudx-cv{position:absolute;inset:8px;width:calc(100% - 16px);height:calc(var(--hudx-h) - 16px)}
.hudx-overlay{position:absolute;left:12px;right:12px;top:8px;display:flex;justify-content:space-between;align-items:center;
  font:11px var(--font-cond);color:rgba(255,210,210,.95);letter-spacing:.5px;text-shadow:0 0 8px rgba(255,47,62,.25);pointer-events:none}
.hudx-title{display:flex;gap:8px;align-items:center}
.hudx-badge{font-size:10px;padding:2px 6px;border:1px solid rgba(255,120,120,.5);color:#ffdcdc;font-family:var(--font-ui)}
.hudx-types{display:flex;gap:4px;flex-wrap:wrap}
.hudx-chip{font-size:9px;padding:1px 5px;border:1px solid rgba(255,120,120,.4);background:rgba(255,47,62,.15);color:#ffeaea;font-family:var(--font-ui)}

button{-webkit-tap-highlight-color:transparent}
[hidden]{display:none!important}
</style>
</head>
<body>

<div class="wrap">
  <header>
    <div class="title"><span class="ball" aria-hidden="true"></span><h1>Pokémon Data Archive – White</h1></div>
  </header>

  <main class="layout" id="app" aria-live="polite">
    <!-- 목록 -->
    <section class="dex" aria-label="포켓몬 목록">
      <h3 class="group">보유 포켓몬</h3>
      <div class="grid" id="grid-owned" role="list"></div>

      <h3 class="group group-wish">위시 포켓몬</h3>
      <div class="grid" id="grid-wish" role="list"></div>
    </section>

    <!-- 상세 -->
    <aside class="details" aria-label="상세 정보">
      <div class="tabs" role="tablist" aria-label="상세 탭">
        <button class="tab-btn" id="tab-info" role="tab" aria-selected="true" aria-controls="panel-info"><span class="ball mini" aria-hidden="true"></span><span>도감설명</span></button>
        <button class="tab-btn" id="tab-data" role="tab" aria-selected="false" aria-controls="panel-data"><span class="ball mini" aria-hidden="true"></span><span>데이터</span></button>
      </div>

      <div class="screen" id="panel-info" role="tabpanel" aria-labelledby="tab-info">
        <div class="big">
          <div class="sprite" id="info-sprite" title="클릭: 울음소리 재생">—</div>
          <div>
            <h2 id="info-name">—</h2>
            <div class="id" id="info-id">NO.—</div>
            <div class="hr"></div>
            <div class="kv" id="info-kv">
              <div class="k">타입</div><div class="v" id="info-types">—</div>
              <div class="k">설명</div><div class="v" id="info-desc">—</div>
            </div>
          </div>
        </div>
        <div class="extra-box" id="info-extra"><div class="placeholder">포켓몬을 선택해주세요.</div></div>
      </div>

      <div class="screen" id="panel-data" role="tabpanel" aria-labelledby="tab-data" hidden>
        <div class="big">
          <div class="sprite" id="data-sprite" title="클릭: 울음소리 재생">DATA</div>
          <div>
            <h2 id="data-name">—</h2>
            <div class="id" id="data-id">NO.—</div>
            <div class="hr"></div>
            <div class="kv" id="data-kv">
              <div class="k">만남</div><div class="v" id="data-met">—</div>
              <div class="k">성격</div><div class="v" id="data-person">—</div>
            </div>
          </div>
        </div>
        <div class="extra-box" id="data-extra"><div class="placeholder">메모를 표시합니다.</div></div>
      </div>

      <div class="hudx-wrap">
        <div class="hudx-panel">
          <canvas id="hudx-cv"></canvas>
          <div class="hudx-overlay">
            <div class="hudx-title"><span class="hudx-badge" id="hudx-id">NO.—</span><span id="hudx-name">—</span></div>
            <div class="hudx-types" id="hudx-types"></div>
          </div>
        </div>
      </div>
    </aside>
  </main>
</div>

<audio id="cry-audio" preload="none"></audio>

<script>
/* ===== Asset bases ===== */
const OA  = 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/';
const CRY_BASE = 'https://raw.githubusercontent.com/PokeAPI/cries/main/cries/pokemon/latest/';

function playCryById(id){
  const a=document.getElementById('cry-audio'); if(!id||!a) return;
  a.src=`${CRY_BASE}${id}.ogg`; a.volume = 0.35; a.play().catch(()=>{});
}

/* ===== Data (설명/메모 그대로 유지) ===== */
const owned = [
  { id:570, name:'조로아', types:['노말','고스트'], spriteOA:'570-hisui.png',
    desc:'사람과 다른 포켓몬의 외형을 모방한다.',
    met:'교류 연구로 확보한 알을 인큐베이션 룸에서 부화했다.',
    personality:'장난꾸러기.',
    memo:'상대와 똑 닮게 둔갑하여 속이거나 놀라게 해서 그 틈에 도망가는 일이 많다. 고독한 트레이너가 조로아크에게 환상을 명령해 외로움을 달랬다는 기록이 전해진다.',
    dmem:'화이트가 실험용으로 길러온 여러 개체 중 하나. 화이트의 어린 시절을 모방하곤 한다. 그 모습으로 여기저기 사고를 치고 돌아다니는 탓에, 늘 골머리를 앓고 있다. 장난이 심해질 때를 대비해 정지 구호를 약속어로 정했으나 도통 말을 듣지 않는다.' },
  { id:81,  name:'코일', types:['전기','강철'], spriteOA:'81.png',
    desc:'공중에 뜬 채로 전기자석파를 방사한다.',
    met:'공업 지대 변압 설비 상공에서 포획.',
    personality:'조용하다.',
    memo:'전선에 들러붙어 전기를 먹고 산다. 정전이 나면 누전차단기를 살펴보는 편이 좋다. 코일이 빽빽이 들러붙어 있을지도 모른다. 체내 전기가 끊겨 땅에서 뒹굴 때 전지를 주면 다시 움직이기 시작한다.',
    dmem:'실험실에 상시 대기하며 각종 기계장치의 전력 공급을 담당하고 있다.' },
  { id:600, name:'기기어르', types:['강철'], spriteOA:'600.png',
    desc:'정해진 조합의 두 개의 몸을 회전시켜 에너지를 만든다.',
    met:'공업 지대에서 기어르를 확보해 장기 관찰 중 기기어르로 진화했다.',
    personality:'침착하다.',
    memo:' 두 개의 몸은 조합 방법이 정해져 있어 다른 몸과는 맞물리지 않고 떨어져 버린다. 먼 옛날 기어르를 본 사람이 톱니바퀴의 구조를 고안했다고 전해진다.',
    dmem:'화이트가 직접 조립·개조해 육성한 포켓몬. 연구 장비의 일부처럼 취급되고 있다.' },
  { id:137, name:'폴리곤', types:['노말'], spriteOA:'137.png',
    desc:'연구 끝에 탄생한 인공 포켓몬이다. 기본적인 동작만 프로그램되어 있다.',
    met:'테스트 서버의 비정상 이동 로그를 추적해 실체화를 성공했다.',
    personality:'말수가 적다.',
    memo:'몸이 프로그램으로 만들어져 전자공간을 자유자재로 이동할 수 있다. 근래에는 컴퓨터 공간을 순찰하며 수상한 데이터를 점검한다. 약 20년 전 과학 기술로 태어난 포켓몬이어서 현재 기준으로 뒤떨어진 부분도 있다.',
    dmem:'구식 포켓몬이지만, 시스템 내부의 오류를 감지하고 분석하는 능력만큼은 여전히 탁월하다. 설계 결함을 파악하는 도구처럼 활용하고 있다. ' },
  { id:474, name:'폴리곤Z', types:['노말'], spriteOA:'474.png',
    desc:'폴리곤2가 출처 불명의 비정품 업데이트를 받아 진화한 형태.',
    met:'폴리곤에 비정품 업데이트가 적용된 뒤 변이로 발생했다.',
    personality:'충동적.',
    memo:'더 우월한 포켓몬을 목표로 추가한 프로그램에 문제가 있었는지 움직임이 괴상하다. 다른 차원을 자유롭게 이동하도록 프로그램을 수정했지만 실수한 듯하다. 부위들이 뒤틀려 있으며 초점을 잃은 눈동자가 특징.',
    dmem:'진화 이후 지나치게 괴상해져 실용성은 거의 사라졌다. 그럼에도 화이트는 알 수 없는 집착을 보이며 언젠가 반드시 폴리곤3을 완성하겠다는 목표를 붙들고 있다.' },
  { id:133, name:'이브이', types:['노말'], spriteOA:'133.png',
    desc:'불규칙한 유전자를 가졌다. 돌에서 나오는 방사선에 의해 몸이 돌연 변이를 일으키기도.',
    met:'연구실 후문 골목의 비에 젖은 상자에서 구조.',
    personality:'환경 변화에 예민하다.',
    memo:'다양한 모습으로 진화할 가능성을 지녔다. 포켓몬 진화의 비밀을 푸는 열쇠가 이 몸 안에 있다고 여겨진다. 주위 영향에 민감한 유전자를 가져 보호자 얼굴을 닮아 간다는 보고가 있다.' ,
    dmem:'연구 목적으로 찾던 개체를 운 좋게 구조했다. 새로운 진화 가능성을 탐구하며 실험을 이어가고 있지만, 좀처럼 마음에 드는 결과가 나오지 않는 모양이다. 진화의 열쇠가 애정에 있다는 사실은 알지 못한 채 실험 데이터만 무수히 쌓아가고 있다.' },
  { id:479, name:'로토무', types:['전기','고스트'], spriteOA:'479.png',
    desc:'기기에 깃들어 형태를 바꾼다.',
    met:'p4 폐연구소 내부의 낡은 기계실.',
    personality:'장난스러운.',
    memo:'특수한 모터를 움직이는 동력원으로서 긴 시간 동안 연구되었던 포켓몬이다. 어떤 소년의 발명에 의해 로토무를 활용한 다양한 기계가 만들어지기 시작했다.',
    dmem:'실용성이 있어 보인다는 이유로 어렵게 찾아 데려왔지만, 현재 온갖 기계 장비에 깃들어 연구실을 교란하고 있다.' },
  { id:649, name:'게노세크트', types:['벌레','강철'], spriteOA:'649.png',
    desc:'3억 년 전에 있었던 포켓몬이다. 플라스마단에게 개조당해 등에 대포가 부착됐다.',
    met:'모 연구실의 냉각 포드에서 탈취했다.',
    personality:'규율적.',
    memo:'특징을 한 단어로 압축하면 ‘사이보그’. 화석에서 부활해 개조된 고대 포켓몬이다. 이미 완전한 존재인 포켓몬에 인간 과학을 덧씌우는 행위에 반대한 N의 결정으로 프로젝트가 중지되고 시설이 폐기되었다. 개조 전 모습은 공개되지 않았다.',
    dmem:'자꾸만 오류를 일으키는 탓에 몬스터볼에 넣어둔 채 좀처럼 꺼내지 않고 있다. 언젠가는 개선해야겠다고 마음속으로만 생각하고 있다.' },
  { id:132, name:'메타몽', types:['노말'], spriteOA:'132.png',
    desc:'전신이 점액질로 이루어진 포켓몬이다. 본 것을 그대로 변신하는 능력을 가졌다.',
    met:'시약 보관고에서 젤상 물질을 분석하다 식별했다.',
    personality:'무던하고 순응적.',
    memo:'표정과 질감까지 높은 정밀도로 복제한다.',
    dmem:'어떤 형상으로든 변할 수 있다는 특성 덕분에 다양한 실험에 투입되고 있다. 대상을 지나치게 오래 모방하다 보면 원본의 버릇까지 그대로 옮겨 버리는 부작용이 나타나는 듯하다.' },
];

const wish = [
  { id:379, name:'레지스틸', types:['강철'], spriteOA:'379.png',
    desc:'과거 사람에 의해 봉인된 포켓몬.',
    memo:'인간을 도와주었지만 그 힘에 공포를 느낀 고대인들에 의해 봉인되었다. 몸체는 지구에는 존재하지 않는 정체불명의 금속으로 이루어졌다고 전해진다.' },
  { id:801, name:'마기아나', types:['강철','페어리'], spriteOA:'801.png',
    desc:'500년 이상 전에 만들어진 인조 포켓몬.',
    memo:'약 500년 전 과학자에 의해 만들어졌다. 기계장치로 된 몸은 그릇에 불과하며 소울하트라고 불리는 인조 영혼이 본체.  의식을 동조시켜 상대의 마음을 이해한다. 다른 포켓몬이 받는 상처나 고통을 느끼고 도와주기 위해 힘을 내는 듯하다. ' },
  { id:150, name:'뮤츠', types:['에스퍼'], spriteOA:'150.png',
    desc:'한 과학자가 몇 년에 걸쳐 유전자의 연구를 계속한 결과 탄생했다.',
    memo:'연구를 위해 유전자를 조합하는 과정에서 난폭한 포켓몬이 되어 버렸다. 과학의 힘으로 몸은 만들었지만 상냥한 마음을 만들 수는 없었다는 모양. 지금은 어딘가의 동굴 깊은 곳에서 잠자고 있다고 전해진다.' },
];

function getAll(){ return [...owned, ...wish]; }
const isWishId = (id) => wish.some(w => w.id === id);

function tSlug(t){
  const m={'노말':'normal','불꽃':'fire','물':'water','전기':'electric','풀':'grass','얼음':'ice','격투':'fighting','독':'poison','땅':'ground','비행':'flying','에스퍼':'psychic','벌레':'bug','바위':'rock','고스트':'ghost','드래곤':'dragon','악':'dark','강철':'steel','페어리':'fairy','???':'unknown'};
  return m[t]||'unknown';
}

/* ===== Rendering (초기 1회만 생성, 이후 선택 토글만) ===== */
const gridOwned=document.getElementById('grid-owned');
const gridWish=document.getElementById('grid-wish');
const tabInfo=document.getElementById('tab-info');
const tabData=document.getElementById('tab-data');
const panelInfo=document.getElementById('panel-info');
const panelData=document.getElementById('panel-data');

let selectedId=null;
const cardMap = new Map(); // id -> element

function makeSpriteImg(primaryFile, id, alt){
  const img=new Image();
  const src1 = OA + (primaryFile || `${id}.png`);
  const src2 = OA + `${id}.png`;
  img.alt=alt; img.loading='lazy'; img.decoding='async'; img.referrerPolicy='no-referrer';
  img.src=src1;
  img.onerror=()=>{ if(img.src!==src2){ img.src=src2; img.onerror=()=>{ img.replaceWith(document.createTextNode(alt)); }; } };
  return img;
}

function makeCard(m, isWish){
  const card=document.createElement('button');
  card.type='button'; card.className='mon-card'+(isWish?' wish':'');
  card.setAttribute('role','listitem'); card.setAttribute('data-id', String(m.id));
  card.setAttribute('aria-selected', 'false');

  const sp=document.createElement('div'); sp.className='sprite';
  sp.appendChild(makeSpriteImg(m.spriteOA, m.id, `${m.name} 아트워크`));

  const meta=document.createElement('div'); meta.className='meta';
  meta.innerHTML=`<div class="no">NO.${String(m.id).padStart(3,'0')}</div>
                  <div class="name">${m.name}</div>
                  <div class="types">${m.types.map(t=>`<span class="type t-${tSlug(t)}">${t}</span>`).join('')}</div>`;

  card.appendChild(sp); card.appendChild(meta);
  card.addEventListener('click',()=>{ selectMon(m.id); playCryById(m.id); });
  cardMap.set(m.id, card);
  return card;
}

function initialRender(){
  gridOwned.innerHTML=''; gridWish.innerHTML='';
  owned.forEach(m=>gridOwned.appendChild(makeCard(m,false)));
  wish.forEach(m=>gridWish.appendChild(makeCard(m,true)));
}

function setTab(which){
  const on=which==='info';
  tabInfo.setAttribute('aria-selected',String(on));
  tabData.setAttribute('aria-selected',String(!on));
  panelInfo.hidden=!on; panelData.hidden=on;
}
tabInfo.addEventListener('click',()=>setTab('info'));
tabData.addEventListener('click',()=>setTab('data'));

const $=id=>document.getElementById(id);

function renderInfo(m){
  $('info-name').textContent=m.name;
  $('info-id').textContent=`NO.${String(m.id).padStart(3,'0')}`;
  $('info-desc').textContent=m.desc||'—';
  $('info-types').innerHTML=(m.types||[]).map(t=>`<span class="type t-${tSlug(t)}">${t}</span>`).join('');
  const sp=$('info-sprite'); sp.textContent=''; sp.style.cursor='pointer';
  sp.appendChild(makeSpriteImg(m.spriteOA, m.id, `${m.name} 아트워크`));
  sp.onclick=()=>playCryById(m.id);
  $('info-extra').innerHTML = `<div class="placeholder">${m.memo?m.memo:'메모/추가 정보를 적을 공간'}</div>`;
  setTab('info');
}
function renderData(m){
  $('data-name').textContent=m.name;
  $('data-id').textContent=`NO.${String(m.id).padStart(3,'0')}`;
  $('data-met').textContent=m.met||'—';
  $('data-person').textContent=m.personality||'—';
  const sp=$('data-sprite'); sp.textContent=''; sp.style.cursor='pointer';
  sp.appendChild(makeSpriteImg(m.spriteOA, m.id, `${m.name} 아트워크`));
  sp.onclick=()=>playCryById(m.id);
  $('data-extra').innerHTML = `<div class="placeholder">${m.dmem?m.dmem:'메모/추가 데이터를 적을 공간'}</div>`;
}

function selectMon(id){
  if(selectedId===id) return;
  const prev = cardMap.get(selectedId);
  const next = cardMap.get(id);
  if(prev) prev.setAttribute('aria-selected','false');
  if(next) next.setAttribute('aria-selected','true');
  selectedId = id;

  const m = getAll().find(x=>x.id===id); if(!m) return;
  const wished = isWishId(id);
  tabData.disabled = wished;
  if(wished) setTab('info');

  renderInfo(m);
  if(!wished) renderData(m);
  if(window.updateHUDX) window.updateHUDX(m);
}

initialRender();
// 첫 포커스: 조로아 선택
selectMon(570);

/* ===== HUD-X Canvas ===== */
(function(){
  const cv=document.getElementById('hudx-cv'); if(!cv) return;
  const ctx=cv.getContext('2d'); const DPR=Math.max(1,window.devicePixelRatio||1);

  function fit(){ const w=cv.clientWidth|0,h=cv.clientHeight|0; if(!w||!h){requestAnimationFrame(fit);return;}
    cv.width=w*DPR; cv.height=h*DPR; ctx.setTransform(DPR,0,0,DPR,0,0); }
  ('ResizeObserver' in window ? new ResizeObserver(fit) : window).observe?.(cv);
  window.addEventListener('resize',fit); fit();

  let SEED=1; function mulberry32(a){return function(){a|=0;a=(a+0x6D2B79F5)|0;let t=Math.imul(a^(a>>>15),1|a);t^=t+Math.imul(t^(t>>>7),61|t);return((t^(t>>>14))>>>0)/4294967296;};}
  let rnd=mulberry32(SEED);
  function reseedFrom(mon){
    const id=mon?.id??0; let h=id*2654435761;
    const s=(mon?.name||'')+(mon?.types||[]).join('|');
    for(let i=0;i<s.length;i++) h=(h^s.charCodeAt(i))+((h<<5)|(h>>>27));
    SEED=(h>>>0)||1; rnd=mulberry32(SEED); buildScene();
  }

  let BLIPS=[],PATH=[];
  function buildScene(){
    const n=7+Math.floor(rnd()*3); BLIPS=[];
    for(let i=0;i<n;i++) BLIPS.push({a:rnd()*Math.PI*2,r:0.25+rnd()*0.65,sp:0.2+rnd()*0.8,pulse:rnd()*6});
    const k=5+Math.floor(rnd()*3); PATH=[]; let ang=0;
    for(let i=0;i<k;i++){ ang+=(Math.PI*2)/k+(rnd()-.5)*0.4; PATH.push({a:ang,r:0.35+rnd()*0.55}); }
  }
  buildScene();

  function ring(cx,cy,R,a=.45){ ctx.strokeStyle=`rgba(255,120,120,${a})`; ctx.lineWidth=2; ctx.beginPath(); ctx.arc(cx,cy,R,0,Math.PI*2); ctx.stroke(); }
  function sweep(cx,cy,R,t){ const a0=t*1.2,span=Math.PI/5; const g=ctx.createRadialGradient(cx,cy,R*.1,cx,cy,R);
    g.addColorStop(0,'rgba(255,60,60,.18)'); g.addColorStop(1,'rgba(255,60,60,0)'); ctx.fillStyle=g; ctx.beginPath(); ctx.moveTo(cx,cy);
    ctx.arc(cx,cy,R,a0,a0+span); ctx.closePath(); ctx.fill(); }
  function arrow(x1,y1,x2,y2){ ctx.strokeStyle='rgba(255,170,170,.7)'; ctx.lineWidth=1.2; ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.stroke();
    const ang=Math.atan2(y2-y1,x2-x1); ctx.beginPath(); ctx.moveTo(x2,y2);
    ctx.lineTo(x2-Math.cos(ang-Math.PI/10)*8,y2-Math.sin(ang-Math.PI/10)*8);
    ctx.lineTo(x2-Math.cos(ang+Math.PI/10)*8,y2-Math.sin(ang+Math.PI/10)*8); ctx.closePath(); ctx.fillStyle='rgba(255,170,170,.7)'; ctx.fill(); }
  function terrainStrip(x,y,w,h,t,bias=0){ ctx.save(); ctx.beginPath(); ctx.rect(x,y,w,h); ctx.clip();
    for(let i=0;i<w;i++){ const u=i/w;
      const n=Math.sin((u*6+t*.5+bias)*3)*.4 + Math.sin((u*1.3+t*.3+bias*2)*5)*.2 + Math.sin((u*9.7+t*.9)*1.3)*.1;
      const elev=(n*.5+.5); const py=y+h*(1-elev);
      ctx.strokeStyle='rgba(255,110,110,.35)'; ctx.lineWidth=1; ctx.beginPath(); ctx.moveTo(x+i,y+h); ctx.lineTo(x+i,py); ctx.stroke();
      if(i%3===0){ ctx.fillStyle='rgba(255,180,180,.25)'; ctx.fillRect(x+i,py-1,1,2); }
    } ctx.restore(); }
  function pokeBall(cx,cy,r,t){
    ctx.save(); ctx.translate(cx,cy); ctx.rotate(t*.7);
    ctx.strokeStyle='rgba(255,150,150,.7)'; ctx.lineWidth=2; ctx.beginPath(); ctx.arc(0,0,r,0,Math.PI*2); ctx.stroke();
    ctx.lineWidth=1.6; ctx.strokeStyle='rgba(255,120,120,.65)'; ctx.beginPath(); ctx.moveTo(-r*0.85,0); ctx.lineTo(r*0.85,0); ctx.stroke();
    ctx.fillStyle='rgba(255,200,200,.95)'; ctx.beginPath(); ctx.arc(0,0,r*0.18,0,Math.PI*2); ctx.fill();
    ctx.strokeStyle='rgba(255,120,120,.8)'; ctx.beginPath(); ctx.arc(0,0,r*0.32,0,Math.PI*2); ctx.stroke();
    ctx.strokeStyle='rgba(255,150,150,.5)'; for(let i=0;i<8;i++){ const a=i/8*Math.PI*2,len=(i%2?6:10);
      ctx.beginPath(); ctx.moveTo(Math.cos(a)*(r-len),Math.sin(a)*(r-len)); ctx.lineTo(Math.cos(a)*r,Math.sin(a)*r); ctx.stroke(); }
    ctx.restore();
  }
  function label(text,x,y,align='left'){
    ctx.save(); ctx.font='11px Galmuri11-Condensed, ui-monospace, monospace';
    ctx.textAlign=align; ctx.textBaseline='middle';
    ctx.shadowColor='rgba(255,60,60,.45)'; ctx.shadowBlur=8;
    ctx.fillStyle='rgba(255,220,220,.95)'; ctx.fillText(text,x,y); ctx.restore();
  }

  let T=0,P=performance.now();
  function loop(now){
    const dt=Math.min(100,now-P)/1000; P=now; T+=dt;
    const w=cv.width/(window.devicePixelRatio||1), h=cv.height/(window.devicePixelRatio||1);
    ctx.clearRect(0,0,w,h);

    const CX=Math.floor(w*0.33), CY=Math.floor(h*0.58), R=Math.min(h*.75,w*.40,120);
    [1,.82,.64,.46,.30].forEach(k=>ring(CX,CY,R*k,k===1?.45:.22));
    ctx.strokeStyle='rgba(255,120,120,.35)'; ctx.beginPath(); ctx.moveTo(CX-R,CY); ctx.lineTo(CX+R,CY); ctx.moveTo(CX,CY-R); ctx.lineTo(CX,CY+R); ctx.stroke();
    sweep(CX,CY,R,T);

    ctx.strokeStyle='rgba(255,170,170,.5)'; ctx.lineWidth=1.2;
    for(let i=0;i<PATH.length-1;i++){ const p=PATH[i],q=PATH[i+1];
      const [x1,y1]=[CX+Math.cos(p.a)*R*p.r,CY+Math.sin(p.a)*R*p.r];
      const [x2,y2]=[CX+Math.cos(q.a)*R*q.r,CY+Math.sin(q.a)*R*q.r];
      arrow(x1,y1,x2,y2);
    }

    BLIPS.forEach(b=>{
      b.pulse+=dt*2;
      const x=CX+Math.cos(b.a)*R*b.r, y=CY+Math.sin(b.a)*R*b.r;
      ctx.fillStyle='rgba(255,220,220,.9)'; ctx.beginPath(); ctx.arc(x,y,2,0,Math.PI*2); ctx.fill();
      ctx.strokeStyle=`rgba(255,120,120,${0.5+0.5*Math.sin(b.pulse)})`;
      ctx.beginPath(); ctx.arc(x,y,6+4*Math.sin(b.pulse),0,Math.PI*2); ctx.stroke();
      b.a += dt*0.2;
    });

    pokeBall(w-42,24,16,T);
    terrainStrip(Math.floor(w*0.48), Math.floor(h-38), Math.floor(w*0.48),28,T*0.6,0.3);

    const coordX=((Math.sin(T*.35)*50+128.0)).toFixed(1);
    const coordY=((Math.cos(T*.42)*50-64.0)).toFixed(1);
    label(`COORD  X:${coordX}  Y:${coordY}`,12,32,'left');

    const name=(document.getElementById('info-name')?.textContent||'SCANNING…').trim();
    label(name||'SCANNING…',CX,CY,'center');
    label('SCAN ϟ TERRAIN / PATH',12,h-12,'left');
    label('ALT~',w-50,h-12,'right');

    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);

  function syncOverlay(){
    const no=(document.getElementById('info-id')?.textContent||'NO.—').trim();
    const name=(document.getElementById('info-name')?.textContent||'—').trim();
    const tbox=document.getElementById('info-types');
    const types=tbox?Array.from(tbox.querySelectorAll('*')).map(n=>n.textContent.trim()).filter(Boolean):[];
    document.getElementById('hudx-id').textContent=no||'NO.—';
    document.getElementById('hudx-name').textContent=name||'—';
    document.getElementById('hudx-types').innerHTML=types.map(t=>`<span class="hudx-chip">${t}</span>`).join('');
  }
  const mo=new MutationObserver(syncOverlay);
  mo.observe(document.getElementById('panel-info'),{subtree:true,childList:true,characterData:true});
  syncOverlay();

  window.updateHUDX=function(mon){ syncOverlay(); reseedFrom(mon); };
})();
</script>
</body>
</html>
